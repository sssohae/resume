<!doctype html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{home/layout}">

<head>
<!-- metas -->
<meta charset="utf-8">
<meta name="author" content="pxdraft" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="keywords" content="ShopApp - eCommerce Bootstrap 5 Template" />
<meta name="description"
	content="ShopApp - eCommerce Bootstrap 5 Template" />
<!-- title -->
<title>마이페이지(주문내역)</title>
<!-- Favicon -->
<link rel="shortcut icon" href="/img/favicon.ico">
<!-- CSS Template -->
<link href="/css/theme.css" rel="stylesheet">
<!-- FullCalendar -->
<link href='/css/main.min.css' rel='stylesheet' />
<script src='/js/main.min.js'></script>
<script src='/js/ko.js'></script>
<style>
body {
	margin: 40px 10px;
	padding: 0;
	font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
	font-size: 14px;
}

#calendar {
	max-width: 1100px;
	margin: 0 auto;
}
</style>

</head>

<body>
	<div layout:fragment="content">
		<!-- Skippy & Prload -->
		
		<div class="wrapper">
			<!-- heder height -->
			<div class="header-height-bar"></div>
			<!-- Header -->
			<header
				class="header-main bg-white header-light fixed-top header-height header-option-1">


			</header>
			<!-- End Header -->
			<!-- Main -->
			<main>
				<!-- Breadcrumb -->
				<div class="py-3 bg-gray-100">
					<div class="container">
						<div class="row align-items-center">
							<div class="col-lg-6 my-2">
								<h1 class="m-0 h4 text-center text-lg-start">마이페이지</h1>
							</div>
							<div class="col-lg-6 my-2">
								<ol
									class="breadcrumb dark-link m-0 small justify-content-center justify-content-lg-end">
									<li class="breadcrumb-item"><a class="text-nowrap"
										href="#"><i class="bi bi-home"></i>홈</a></li>
									<li class="breadcrumb-item text-nowrap active"
										aria-current="page">마이페이지</li>
								</ol>
							</div>
						</div>
					</div>
				</div>
				<!-- End Breadcrumb -->
				<!-- Table -->
				<div class="py-6">
					<div class="container">
						<div class="row" th:each="mem : ${memberInfo}">
							<!-- Profile Menu -->
							<div class="col-lg-4 pb-4 pb-lg-0 col-xxl-3  pe-xxl-5">
								<div class="bg-white border border-bottom-0 shadow-lg">
									<div class="d-flex p-3 align-items-center">
										<div class="avatar avatar-lg rounded-circle">
											<img th:src="${mem.profile}" title=""
												alt="">
										</div>
										<div class="col ps-3">
											<h6 class="m-0" th:text="${mem.id}">닉네임</h6>
											<small><a href="#" th:text="${mem.name}">이름</a></small>
										</div>
									</div>
									<ul class="list-unstyled mb-0 theme-link">
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											href="account-profile.html"> <i class="fi-user me-2"></i>회원정보수정
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center active p-3"
											href="account-order.html"> <i class="bi bi-bag me-2"></i>
												주문내역
												<div class="ms-auto badge-pill badge bg-secondary"></div>
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center active p-3"
											href="account-order.html"> <i class="bi-cash-stack me-2"></i>
												내포인트내역
												<div class="ms-auto badge-pill badge bg-secondary"></div>
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center active p-3"
											href="account-order.html"> <i class="bi-ticket me-2"></i>
												쿠폰내역
												<div class="ms-auto badge-pill badge bg-secondary"></div>
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center active p-3"
											href="account-order.html"> <i class="fi-heart me-2"></i>
												찜
												<div class="ms-auto badge-pill badge bg-secondary"></div>
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											href="account-wishlist.html"> <i
												class="bi-hand-thumbs-up me-2"></i>좋아요
												<div class="ms-auto badge-pill badge bg-secondary"></div>
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											th:href="@{/silhyun/myPage/myClasses}"> <i
												class="bi-play-btn me-2"></i>내 클래스
												<div class="ms-auto badge-pill badge bg-secondary"></div>
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											href="account-tickets.html"> <i
												class="bi-chat-square-dots me-2"></i>문의내역
												<div class="ms-auto badge-pill badge bg-secondary"></div>
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											href="account-address.html"> <i class="bi-calendar me-2"></i>캘린더
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											href="account-payment.html"> <i
												class="bi bi-credit-card me-2"></i>결제내역
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											href="account-payment.html"> <i
												class="bi-person-bounding-box me-2"></i>내 히스토리
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											href="account-payment.html"> <i
												class="bi-hand-thumbs-down me-2"></i>신고내역
										</a></li>
										<li class="border-bottom mb-0"><a
											class="nav-link-style d-flex align-items-center p-3"
											href="/mpg/checkPassword"> <i
												class="bi bi-box-arrow-left me-2"></i>회원탈퇴
										</a></li>
									</ul>
								</div>
							</div>
							<!-- End Profile Menu -->
							<!-- Content -->
							<div style="width: 950px;">
								<div id='calendar'></div>
							</div>
							<!-- End Content -->
						</div>
					</div>
				</div>
				<!--Table -->
			</main>
			<!-- End Main -->
			<!-- Footer -->

			<!-- End Footer -->
		</div>
		<!-- 
    ========================
       End Wrapper 
    ========================
    -->
		<!-- script start -->
		<!-- jquery -->
		<script src="../../assets/js/jquery-3.5.1.min.js"></script>
		<!--bootstrap-->
		<script src="../../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<!-- slick carousel -->
		<script src="../../assets/vendor/swiper/swiper-bundle.min.js"></script>
		<!-- magnific -->
		<script
			src="../../assets/vendor/magnific/jquery.magnific-popup.min.js"></script>
		<!-- isotope -->
		<script src="../../assets/vendor/isotope/isotope.pkgd.min.js"></script>
		<!-- count-down -->
		<script src="../../assets/vendor/count-down/jquery.countdown.min.js"></script>
		<!-- count-down -->
		<script src="../../assets/vendor/jarallax/jarallax-all.js"></script>
		<!-- Theme Js -->
		<script src="../../assets/js/custom.js"></script>
		<script src="../../assets/js/theme.js"></script>

		<!-- Fullcalendar -->
		<script th:inline="javascript">
		
		/*<![CDATA[*/   
        var role = /*[[${session.role}]]*/
        var name = /*[[${session.id}]]*/
       /*]]*/
       console.log(role[0].authority)
       
       console.log(name)
    </script>
		
		<script>
		
			document.addEventListener('DOMContentLoaded',function() {
				
				var calendarEl = document.getElementById('calendar');	
				var calendar = new FullCalendar.Calendar(			
					calendarEl,{	
						locale : 'ko',
						headerToolbar : {
							left : 'prev,next today',
							center : 'title',
							right : 'dayGridMonth'
						},
						initialDate : '2023-03-01',
						navLinks : true,
						selectable : true,
						selectMirror : true,

						select : function(arg) {
							
							let cntn = prompt('일정 제목을 입력해주세요:');
							if (cntn) {
								
								let id = name;
								let todoDate = arg.startStr;
								let eventData = {
									id : id,
									cntn : cntn,
									todoDate : todoDate
								};
								$.ajax({
									type : 'post',
									url : '/scheduleInsert',
									contentType : 'application/json; charset=utf-8',
									data : JSON.stringify(eventData),
									success : function(response) {
										if (response.res > 0) {
												calendar.addEvent({
												title : response.todo.cntn,
												start : response.todo.todoDate,
												extendedProps : {
													todoNum : response.todo.todoNum
												}
											});
													
											alert('일정이 추가되었습니다.');
											console.log(eventData)
													
										} else {
											alert('일정 추가에 실패했습니다.');
										}
									},
									error : function() {
										alert('서버 오류가 발생했습니다.');
									}
								});
							}
							calendar.unselect();
						},
						eventClick : function(arg) {
							var todoNum = arg.event.extendedProps.todoNum;

							console.log(todoNum);
							let cc = confirm("일정을 삭제 하시겠습니까?")
							if (!cc)
								return;
							$.ajax({
								url : '/scheduleDelete/'+todoNum,
								//method : 'DELETE',
								//contentType : 'application/json',
								//data : {
								//	num : todoNum
								//},
								success : function(
										response) {
									console.log(response);
								},
								error : function(
										error) {
									console.log(error);
								}
							});
						},
						editable : false,
						dayMaxEvents : true,
						events : [],
						loading : function(bool) {
							if (bool) {
								$.ajax({
									url : '/getScheduleList',
									method : 'GET',
									success : function(response) {
												console.log(response);
										for ( let i in response) {
											calendar.addEvent({
												title : response[i].cntn,
												start : response[i].todoDate,
												extendedProps : {
													todoNum : response[i].todoNum
												}
											});
										}
									}
								})
							}
						},

					});

				calendar.render();
			});
		</script>

		<!-- End script start -->
	</div>
</body>

</html>
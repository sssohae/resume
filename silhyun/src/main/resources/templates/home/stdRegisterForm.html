<!doctype html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{home/layout}">

<head>
    <!-- metas -->
    <meta charset="utf-8">
    <meta name="author" content="pxdraft" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="keywords" content="ShopApp - eCommerce Bootstrap 5 Template" />
    <meta name="description" content="ShopApp - eCommerce Bootstrap 5 Template" />
    <!-- title -->
    <title>ShopApp - eCommerce Bootstrap 5 Template</title>
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
    <!-- ìš°í¸ë²ˆí˜¸ API -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    <style>
        .regi {
            width: 300px;
        }
        .zip{
        width: 150px;
        }
    </style>
</head>

<body>
    <div layout:fragment="content">
        <!-- Skippy & Prload -->
        <!-- skippy -->
        <a id="skippy" class="skippy visually-hidden-focusable overflow-hidden" href="#content">
            <div class="container">
                <span class="u-skiplink-text">Skip to main content</span>
            </div>
        </a>
        <!-- End skippy -->
        <!-- Preload -->
        <!-- <div id="loading" class="loading-preloader">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div> -->
        <!-- End Preload -->
        <!-- Edn Skippy & Prload -->
        <!-- Size Chart  -->


        <!-- End Size Chart  -->
        <!-- 
    ========================
        Wrapper 
    ========================
    -->
        <div class="wrapper">
            <div class="header-height-bar"></div>
            <!-- Main -->
            <main>
                <!-- Page Title -->
                <div class="py-3 bg-gray-100">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-lg-6 my-2">
                                <h1 class="m-0 h4 text-center text-lg-start"></h1>
                            </div>
                            <div class="col-lg-6 my-2">
                                <ol
                                    class="breadcrumb dark-link m-0 small justify-content-center justify-content-lg-end">
                                    <li class="breadcrumb-item"><a class="text-nowrap" href="/"><i
                                                class="bi bi-home"></i>Home</a></li>
                                    <li class="breadcrumb-item text-nowrap active" aria-current="page">ì‚¬ì§„ê´€ ë“±ë¡</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Page Title -->
                <!-- Section -->
                <section class="section">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-md-7">
                                <!-- ë“±ë¡ Form -->
                                <form id="ptgRegiFrm" action="/shin/stdRegister" method="post">
                                    <!-- Heading -->
                                    <h6 class="mb-4 h3">ì‚¬ì§„ê´€ ì…ì  ì‹ ì²­ì„œ</h6>
                                    <!-- Billing details -->

                                    <div class="form-group mb-3">
                                        <label for="stName" class="form-label">ì‚¬ì§„ê´€ ì´ë¦„<span
                                                class="text-danger">*</span></label>
                                        <input type="text" id="stName" name="stName" class="form-control regi"
                                             required="required">
                                    </div>
                                    <div class="form-group mb-3">
                                        <label for="ceoName" class="form-label">ëŒ€í‘œì ì´ë¦„<span class="text-danger">*</span></label>
                                        <input type="text" id="ceoName" name="ceoName" class="form-control regi"
                                            readonly="readonly" th:value="${member.name}">
                                    </div>
                                   
                                    <div class="form-group mb-3">
                                        <label class="form-label col" for="crn">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸<span
                                                class="text-danger">*</span></label>
                                        <div class="d-flex">
                                            <input type="text" class="form-control regi" id="crn"
                                                placeholder="-ì„ ì œì™¸í•œ 10ìë¦¬ ìˆ«ìë¥¼ ì ì–´ì£¼ì„¸ìš”" name="crn">
                                            <button type="button" class="btn btn-primary w-20 ms-2 crnBtn" id="btnId"
                                                value="No">ì‚¬ì—…ì
                                                ì¸ì¦</button>
                                        </div>
                                          <div class="text-danger error-msg"></div>
                                    </div>

                                    <div class="form-group mb-3">
                                        <label class="form-label col" for="sample6_address">ì‚¬ì§„ê´€ ì£¼ì†Œ<span
                                                class="text-danger">*</span></label>
                                        <div class="d-flex">
                                            <input type="text" class="form-control zip" id="sample6_postcode" placeholder="ìš°í¸ë²ˆí˜¸" name="zipAddr" required>
                                            <button type="button" class="btn btn-primary w-20 ms-2 addrBtn" id="btnId2"
                                             value="No" onclick="sample6_execDaumPostcode()">ì°¾ê¸°</button>
                                        </div><br>
                                         <div class="d-flex">
                                            <input type="text" class="form-control regi" id="sample6_address" placeholder="ì£¼ì†Œ" name="addr"> 
                                            <input type="text"  class="form-control regi ms-2" id="sample6_extraAddress" placeholder="ì°¸ê³ í•­ëª©"name="detAddr">
                                            <input type="text" class="form-control regi ms-2" id="sample6_detailAddress" placeholder="ìƒì„¸ì£¼ì†Œ" > 
                                    </div>
                                    </div>

                                    <label class="form-label col">ì§€ì—­<span class="text-danger">*</span></label>
                                    <div class="dropdown btn btn-white border" style="size: 100px; text-align: left;">
                                        <select id="selectOp" name="regionCd" style="border: 1px solid white;" required>
                                            <option disabled>::ì„ íƒ::</option>
                                            <option value="01">ì„œìš¸</option>
                                            <option value="02">ê²½ê¸°</option>
                                            <option value="03">ì¸ì²œ</option>
                                            <option value="04">ê°•ì›</option>
                                            <option value="05">ëŒ€ì „/ì¶©ì²­</option>
                                            <option value="06">ëŒ€êµ¬</option>
                                            <option value="07">ë¶€ì‚°/ìš¸ì‚°</option>
                                            <option value="08">ê²½ìƒ</option>
                                            <option value="09">ê´‘ì£¼/ì „ë¼</option>
                                            <option value="10">ì œì£¼</option>
                                        </select>
                                    </div><br><br>

                                    <input type="hidden" name="stId" th:value="${id}">
                                    <button style="margin-top: 10px;" type="button" class="btn btn-primary w-20 ms-2"
                                        onclick="insertPtgRegi()">ì‹ ì²­</button>
                                    <button style="margin-top: 10px;" type="button" class="btn btn-primary w-20 ms-2"
                                        onclick="location.href = '/'">ì·¨ì†Œ</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- End Section -->
            </main>
            <!-- End Main -->
        </div>


        <!-- 
    ========================
       End Wrapper 
    ========================
    -->
        <!-- script start -->
        <!--bootstrap-->
        <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- slick carousel -->
        <script src="/vendor/swiper/swiper-bundle.min.js"></script>
        <!-- magnific -->
        <script src="/vendor/magnific/jquery.magnific-popup.min.js"></script>
        <!-- isotope -->
        <script src="/vendor/isotope/isotope.pkgd.min.js"></script>
        <!-- count-down -->
        <script src="/vendor/count-down/jquery.countdown.min.js"></script>
        <!-- count-down -->
        <script src="/vendor/jarallax/jarallax-all.js"></script>
        <!-- Theme Js -->
        <script src="/js/custom.js"></script>
        <script src="/js/theme.js"></script>
        <!-- End script start -->
        <script>
            //ğŸ“Œì‚¬ì—…ìë“±ë¡ì „ë³´ ì§„ìœ„í™•ì¸ ë° ìƒíƒœì¡°íšŒ ì„œë¹„ìŠ¤
            $('.btn.btn-primary.w-20.ms-2.crnBtn').on('click', function () {
                let b_no = $('input[name="crn"]').val()
                var data = {
                    "b_no": [b_no]
                }
                console.log(b_no)

                $.ajax({
                    url: "https://api.odcloud.kr/api/nts-businessman/v1/status?serviceKey=flAksztYZxKbLInc2tRUFueJockBytqC38SEfZrmIVJDDdEOKff8DULN%2FSEDFJQX2AFxyrhNlJwG0cuCHll6Iw%3D%3D", // serviceKey ê°’ì„ xxxxxxì— ì…ë ¥
                    type: "POST",
                    data: JSON.stringify(data), // json ì„ stringìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
                    dataType: "JSON",
                    contentType: "application/json",
                    accept: "application/json",
                    success: function (result) {
                        console.log(result);
                        console.log(result.data[0].b_stt_cd)
                        // let num =Number(result.data[0].b_no)
                        // $('input[name="crn"]').val(num)
                        // console.log(num)
                        if (result.data[0].b_stt_cd == '01') {
                            alert("ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ê°€ ì¸ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.")
                            $('.btn.btn-primary.w-20.ms-2.crnBtn').val('Yes')
                            $('.btn.btn-primary.w-20.ms-2.crnBtn').attr("disabled", true)

                        } else {
                            alert("êµ­ì„¸ì²­ì— ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ì…ë‹ˆë‹¤.")
                        }
                        
                    },
                    error: function (result) {
                        console.log(result.responseText); //responseTextì˜ ì—ëŸ¬ë©”ì„¸ì§€ í™•ì¸
                    }
                });
            })
            
            //ğŸ“Œì‹ ì²­ ë²„íŠ¼ì„ ëˆŒë €ì„ë•Œ event
            function insertPtgRegi() {
                let btnCk = $('.btn.btn-primary.w-20.ms-2.crnBtn').val()
                let addrCk =$('.btn.btn-primary.w-20.ms-2.addrBtn').val()
                var formData = new FormData($('#ptgRegiFrm')[0])
                // for (let i = 0; i < selFiles.length; i++) {
                //     formData.append("files", selFiles[i])
                // }
                if (btnCk == 'No') {
                    alert('ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì¸ì¦ì„ í•˜ì„¸ìš”.')
                    return false
                }
              
                $.ajax({
                    url: "/shin/stdRegister",
                    type: "post",
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (res) {
                        alert("ì •ìƒì ìœ¼ë¡œ ì‚¬ì§„ê´€ ì‹ ì²­ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.")
                        location.href = "/"; //ë“±ë¡ ë˜ë©´ í™ˆìœ¼ë¡œ ì´ë™ 
                    },
                    error: function (err) {
                        console.log(err)
                    }
                })
                return false;
            }

            //ğŸ“Œìš°í¸ë²ˆí˜¸Api
            function sample6_execDaumPostcode() {
                new daum.Postcode({
                oncomplete: function(data) {
                    // íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„.

                    // ê° ì£¼ì†Œì˜ ë…¸ì¶œ ê·œì¹™ì— ë”°ë¼ ì£¼ì†Œë¥¼ ì¡°í•©í•œë‹¤.
                    // ë‚´ë ¤ì˜¤ëŠ” ë³€ìˆ˜ê°€ ê°’ì´ ì—†ëŠ” ê²½ìš°ì—” ê³µë°±('')ê°’ì„ ê°€ì§€ë¯€ë¡œ, ì´ë¥¼ ì°¸ê³ í•˜ì—¬ ë¶„ê¸° í•œë‹¤.
                    var addr = ''; // ì£¼ì†Œ ë³€ìˆ˜
                    var extraAddr = ''; // ì°¸ê³ í•­ëª© ë³€ìˆ˜

                    //ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì£¼ì†Œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                    if (data.userSelectedType === 'R') { // ì‚¬ìš©ìê°€ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°
                        addr = data.roadAddress;
                    } else { // ì‚¬ìš©ìê°€ ì§€ë²ˆ ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°(J)
                        addr = data.jibunAddress;
                    }

                    // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œê°€ ë„ë¡œëª… íƒ€ì…ì¼ë•Œ ì°¸ê³ í•­ëª©ì„ ì¡°í•©í•œë‹¤.
                    if(data.userSelectedType === 'R'){
                        // ë²•ì •ë™ëª…ì´ ìˆì„ ê²½ìš° ì¶”ê°€í•œë‹¤. (ë²•ì •ë¦¬ëŠ” ì œì™¸)
                        // ë²•ì •ë™ì˜ ê²½ìš° ë§ˆì§€ë§‰ ë¬¸ìê°€ "ë™/ë¡œ/ê°€"ë¡œ ëë‚œë‹¤.
                        if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
                            extraAddr += data.bname;
                        }
                        // ê±´ë¬¼ëª…ì´ ìˆê³ , ê³µë™ì£¼íƒì¼ ê²½ìš° ì¶”ê°€í•œë‹¤.
                        if(data.buildingName !== '' && data.apartment === 'Y'){
                            extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                        }
                        // í‘œì‹œí•  ì°¸ê³ í•­ëª©ì´ ìˆì„ ê²½ìš°, ê´„í˜¸ê¹Œì§€ ì¶”ê°€í•œ ìµœì¢… ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
                        if(extraAddr !== ''){
                            extraAddr = ' (' + extraAddr + ')';
                        }
                        // ì¡°í•©ëœ ì°¸ê³ í•­ëª©ì„ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                        document.getElementById("sample6_extraAddress").value = extraAddr;
                    
                    } else {
                        document.getElementById("sample6_extraAddress").value = '';
                    }

                    // ìš°í¸ë²ˆí˜¸ì™€ ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                    document.getElementById('sample6_postcode').value = data.zonecode;
                    document.getElementById("sample6_address").value = addr;
                    // ì»¤ì„œë¥¼ ìƒì„¸ì£¼ì†Œ í•„ë“œë¡œ ì´ë™í•œë‹¤.
                    document.getElementById("sample6_detailAddress").focus();
            }
        }).open();
    }
            
            //ì •ê·œì‹ ì´ìš©í•œ ìœ íš¨í™”ê²€ì‚¬
        	const errMsg =  "-ì„ ì œì™¸í•œ 10ìë¦¬ ìˆ«ìë¥¼ ì ì–´ì£¼ì„¸ìš”"
        	let regi = "",
        		isCrnValid = false
        	let regiInput = $('#crn')
        	console.log(regiInput.val())
        	let ErrorMsgEl = $('.error-msg')
        	$(regiInput).on('change', () => {
        		let crnRegExp = /^(?=.*[0-9])[0-9]{10}$/
        		regi = $(regiInput).val()
        		if (crnRegExp.test(regi)) { // ì •ê·œì‹ ì¡°ê±´ ë§Œì¡± O
        			isCrnValid = true
                    $(ErrorMsgEl).text('')
        		} else { // ì •ê·œì‹ ì¡°ê±´ ë§Œì¡± X
        			isCrnValid = false
        			$(regiInput).val('')
        			$(ErrorMsgEl).text(errMsg)
        		}
        	})
        </script>

    </div>
</body>

</html>
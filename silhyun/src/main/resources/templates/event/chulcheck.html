<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{home/layout}">
<head>
<script
	src="
https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js
"></script>
<script src="https://code.jquery.com/jquery-3.6.3.js"
	integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
	crossorigin="anonymous"></script>
<link rel="shortcut icon" href="/img/favicon.ico">
<style>
/* ======== Calendar ======== */
.my-calendar {
	width: 100%;
	height: 400px;
	/*           margin: 30px; */
	padding: 20px 20px 10px;
	text-align: center;
	font-weight: 800;
	border: 1px solid #ddd;
	cursor: default;
}

.my-calendar .clicked-date {
	border-radius: 25px;
	margin-top: 1;
	float: left;
	width: 1;
	text-align: center;
	padding: 46px 0 26px;
	background: #ddd;
}

.my-calendar .calendar-box {
	width: 100%;
	height: 400px;
}

.clicked-date .cal-day {
	/* font-size: 1px; */
	font-size: 24px;
}

.clicked-date .cal-date {
	/* font-size: 1px; */
	font-size: 130px;
}

.ctr-box {
	padding: 0 16px;
	margin-bottom: 20px;
	font-size: 20px;
}

.ctr-box .btn-cal {
	position: relative;
	float: left;
	width: 25px;
	height: 25px;
	margin-top: 5px;
	font-size: 16px;
	cursor: pointer;
	border: none;
	background: none;
}

.ctr-box .btn-cal:after {
	content: '<';
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	line-height: 25px;
	font-weight: bold;
	font-size: 20px;
}

.ctr-box .btn-cal.next {
	float: right;
}

.ctr-box .btn-cal.next:after {
	content: '>';
}

.cal-table {
	width: 100%;
}

.cal-table th {
	width: 14.2857%;
	padding-bottom: 5px;
	font-size: 16px;
	font-weight: 900;
}

.cal-table td {
	padding: 3px 0;
	height: 50px;
	font-size: 15px;
	vertical-align: middle;
}

.cal-table td.day {
	position: relative;
	cursor: pointer;
	color: rgb(0, 0, 0);
}

.cal-table td.today {
	background: #ffd255;
	border-radius: 50%;
	color: #fff;
}


.cal-table td.has-event:after {
	content: '';
	display: block;
	position: absolute;
	left: 0;
	bottom: 0;
	width: 100%;
	height: 4px;
	background: #FFC107;
}

.res-yes {
	background-color: black;
}

.res-no {
	background-color: lightgray;
}

.form-check-input {
	width: 20px;
	height: 20px;
	margin-bottom: 7px;
}

.form-check-label {
	font-weight: bold;
}

#selectDate {
	font-size: larger;
	font-weight: bolder;
}

#selectTime {
	font-size: larger;
	font-weight: bolder;
}
/*ì¶œì„ì²´í¬ ì„±ê³µì‹œ ë°”ë€” ìƒ‰*/
 td.success {
        background-color: green;
        color: white;
      }
/* dbì— ìˆëŠ” ë‚ ì§œì˜ ìƒ‰ì„ ë°”ê¿ˆ */      
.selected {
  background-color: green;
  color: white;
}
</style>

<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<main layout:fragment="content">
		<div class="my-calendar clearfix">

			<div class="clicked-date" style="display: none;">
				<div class="cal-day"></div>
				<div class="cal-date"></div>
			</div>
			<!--<div class="my-calendar clearfix">-->
			<div class="calendar-box">
				<div class="ctr-box clearfix">
					<button type="button" title="prev" class="btn-cal prev"></button>
					<span class="cal-month"></span> <span class="cal-year"></span>
					<button type="button" title="next" class="btn-cal next"></button>
				</div>

				<table class="cal-table">
					<thead>
						<tr>
							<th id="ì¼"><font color="#F79DC2">ì¼ </th>
							<th id="ì›”">ì›”</th>
							<th id="í™”">í™”</th>
							<th id="ìˆ˜">ìˆ˜</th>
							<th id="ëª©">ëª©</th>
							<th id="ê¸ˆ">ê¸ˆ</th>
							<th id="í† "><font color="skyblue">í†  </th>
						</tr>
					</thead>
					<tbody class="cal-body"></tbody>
				</table>
			</div>
		</div>

		<div>
			<!-- form actionìœ¼ë¡  ë³´ë‚´ì§ -->
			<form id="chulcheckFrm" method="post">
				<div>
					<!-- 	<input type="hidden"  name="id" value="${id}">  -->
					<input type="hidden" name="id" th:value="${session.id}">
					<p th:text="${date}"></p>
					<input type="hidden" name="checkDate" th:value="${date}">
				</div>
				<div>
					<button type="button" class="btn btn-primary" id="chulcheck-button">ì¶œì„ì²´í¬</button>
				</div>
			</form>
		</div>
<script>
	
	
	//ìº˜ë¦°ë”
	const init = {
	              monList: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October',
	                'November', 'December'
	              ],
	              dayList: ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '],
	              today: new Date(), // ì˜¤ëŠ˜ ë‚ ì§œ
	              monForChange: new Date().getMonth(),
	              activeDate: new Date(),
	              getFirstDay: (yy, mm) => new Date(yy, mm, 1),
	              getLastDay: (yy, mm) => new Date(yy, mm + 1, 0),
	              nextMonth: function () { // ë‹¤ìŒ ë²„íŠ¼ì„ í´ë¦­ ->  í•´ë‹¹í•˜ëŠ” ë‹¬ì„ 1 ì¦ê°€ì‹œí‚¨ í›„ ê·¸ ìˆ«ìë¥¼ ìƒˆë¡œ ê°€ì ¸ì˜¨ ë‚ ì§œ ê°ì²´ dì— d.setMonth()
	                let d = new Date();
	                d.setDate(1); //5ì›” 31ì¼ì— nextMonth í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œ ë‹¬ë§Œ 6ì›”ë¡œ ë°”ê¿”ì¤„ ê²½ìš° 6ì›”ì—ëŠ” 30ì¼ê¹Œì§€ë°–ì— ì—†ìœ¼ë¯€ë¡œ ìë™ìœ¼ë¡œ 7ì›” 1ì¼ë¡œ ë³€ê²½ë  ìˆ˜ ìˆ
	                d.setMonth(++this.monForChange);
	                this.activeDate = d;
	                return d;
	              },
	              prevMonth: function () { //ì´ì „ ë²„íŠ¼ í´ë¦­
	                let d = new Date();
	                d.setDate(1);
	                d.setMonth(--this.monForChange);
	                this.activeDate = d;
	                return d;
	              },
	              addZero: (num) => (num < 10) ? '0' + num : num,
	              activeDTag: null,
	              getIndex: function (node) {
	                let index = 0;
	                while (node = node.previousElementSibling) {
	                  index++;
	                }
	                return index;
	              }
	            };
	const $calBody = document.querySelector('.cal-body');
    const $btnNext = document.querySelector('.btn-cal.next');
    const $btnPrev = document.querySelector('.btn-cal.prev');

    function loadDate(date, dayIn) {
      document.querySelector('.cal-date').textContent = date;
      document.querySelector('.cal-day').textContent = init.dayList[dayIn];
    }
    
    function loadYYMM(fullDate) { //ë™ì ìœ¼ë¡œ ë‹¬ë ¥ì˜ ì¼ì ì¶œë ¥ / ì²˜ìŒ ìº˜ë¦°ë” ë¡œë“œí• ë•Œ/ ë‹¬ë ¥ì—ì„œ ì´ì „,ì´í›„ ë²„íŠ¼ì„ í´ë¦­í• ë•Œ ì‹¤í–‰ë¨ 
        let yy = fullDate.getFullYear();
        let mm = fullDate.getMonth();
        let firstDay = init.getFirstDay(yy, mm);
        let lastDay = init.getLastDay(yy, mm);
        let markToday; // ë‹¬ë ¥ì˜ ë…„ë„/ì›”ì´ ì˜¤ëŠ˜ ë‚ ì§œì˜ ë…„ë„/ì›”ê³¼ ì¼ì¹˜í•˜ë©´ ì˜¤ëŠ˜ ë‚ ì§œì˜ ì¼ìë¥¼ í• ë‹¹

        if (mm === init.today.getMonth() && yy === init.today.getFullYear()) {
          markToday = init.today.getDate();
        }

        document.querySelector('.cal-month').textContent = init.monList[mm];
        document.querySelector('.cal-year').textContent = yy;

        let trtd = '';
        let startCount;
        let countDay = 0;
        for (let i = 0; i < 6; i++) { //í•œë‹¬ì— ìˆëŠ” í•œ ì£¼ 
          trtd += '<tr class="week">';
          for (let j = 0; j < 7; j++) { //í•œì£¼ì— ë“¤ì–´ìˆëŠ” ì¼
            if (i === 0 && !startCount && j === firstDay.getDay()) { //ë‚ ì§œê°€ ì²˜ìŒ ì‹œì‘í•˜ë©´ startCountì„ 1ë¡œ ë³€ê²½
              startCount = 1;
            }
            if (!startCount) {
              trtd += `<td>`
            } else {
              let dayList = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ']
              let fullDate = yy + '-' + init.addZero(mm + 1) + '-' + init.addZero(countDay + 1);
              let today = new Date(yy + '-' + init.addZero(mm + 1) + '-' + init.addZero(countDay + 1)).getDay()
              trtd += '<td class="day';
              trtd += (markToday && markToday === countDay + 1) ? ' today" ' :
              '"'; //countDay ë³€ìˆ˜ê°€ markToday ê°’ê³¼ ì¼ì¹˜í•˜ë©´ tdì— today í´ë˜ìŠ¤
              trtd += ` data-date="${countDay + 1}" data-fdate="${fullDate}" id="${dayList[today]}">` //id="${item}"
            }
            trtd += (startCount) ? ++countDay : '';
            if (countDay === lastDay.getDate()) { //ë‚ ì§œ ì„¸ëŠ” ê²ƒì´ ëë‚˜ë©´ startCountë³€ìˆ˜ë¥¼ ë‹¤ì‹œ 0ìœ¼ë¡œ ì´ˆê¸°í™”
              startCount = 0;
            }
            trtd += '</td>';
          }
          trtd += '</tr>';
        }
        $calBody.innerHTML = trtd;
      }
    function createNewList(val) {
        let id = new Date().getTime() + '';
        let yy = init.activeDate.getFullYear();
        let mm = init.activeDate.getMonth() + 1;
        let dd = init.activeDate.getDate();
        const $target = $calBody.querySelector(`.day[data-date="${dd}"]`);
        let date = yy + '.' + init.addZero(mm) + '.' + init.addZero(dd);

        let eventData = {};
        eventData['date'] = date;
        eventData['memo'] = val;
        eventData['complete'] = false;
        eventData['id'] = id;
        init.event.push(eventData);
        $todoList.appendChild(createLi(id, val, date));
      }

      loadYYMM(init.today);
      loadDate(init.today.getDate(), init.today.getDay());

      $btnNext.addEventListener('click', () => loadYYMM(init.nextMonth())); //ë‹¤ìŒ ë²„íŠ¼ í´ë¦­í•˜ë©´ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸
      $btnPrev.addEventListener('click', () => loadYYMM(init.prevMonth())); //ì´ì „ ë²„íŠ¼ í´ë¦­í•˜ë©´ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸

      
      //ì¶”ê°€
      
      
  	var id=$('input[name=id]').val();
	var checkDate=$('input[name=checkDate]').val();
	var todayCells = document.querySelectorAll(".cal-table td.today");
	$(function() {
	  $('#chulcheck-button').click(function() {
	    $.ajax({
	      url: '/chulcheckEv',
	      method: 'POST',
	      data: { id: id, checkDate: checkDate },
	      success: function(result) {
	    	  if(result === true) {
	    	      alert("ì¶œì„ ì²´í¬ ì™„ë£ŒğŸ‰");
	    	      $('.cal-table td.today').css({
	    	    	    'background-color': "#B96F4A",
	    	    	    'color': '#fff',
	    	    	    'border-radius': '0%',
	    	    	    'opacity': '0.7'
	    	    	  });
	    	    } else {
	    	      alert('ì´ë¯¸ ì¶œì„í•˜ì˜€ìŠµë‹ˆë‹¤.');
	    	      
	    	    }
	      },
	      error: function(reject) {
	    	window.location.href="/login"
	        alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”');
	      }
	    });
	  });
	});

</script>

	</main>
</body>
</html>
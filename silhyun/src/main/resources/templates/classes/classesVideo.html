<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      layout:decorate="~{home/layout}">
<head>
    <!-- metas -->
    <meta charset="utf-8">
    <meta name="author" content="pxdraft" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="keywords" content="ShopApp - eCommerce Bootstrap 5 Template" />
    <meta name="description" content="ShopApp - eCommerce Bootstrap 5 Template" />
    <!-- title -->
    <title>ShopApp - eCommerce Bootstrap 5 Template</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    <!-- CSS Template -->
    <link href="/css/theme.css" rel="stylesheet">
	<!-- 꽃가루 날리기 -->
	<script src="https://tistory4.daumcdn.net/tistory/3134841/skin/images/confetti_v2.js"></script>
    
    <style>
    
    	canvas{
   				z-index:10;pointer-events: none;position: fixed;top: 0;transform: scale(1.1);
   				right:0;
   				}
    	
        body {
            font-family: "Lato", sans-serif;
        }

        .sidenav {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            right: 0;
            background-color: #111;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 300px;
        }

        .sidenav a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 18px;
            color: #ffffff;
            display: block;
            transition: 0.3s;
        }

        .sidenav a:hover {
            color: #f1f1f1;
        }

        .sidenav .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
            margin-top: 150px;
        }

        @media screen and (max-height: 450px) {
            .sidenav {
                padding-top: 15px;
            }

            .sidenav a {
                font-size: 18px;
            }
        }
    </style>
</head>

<body>
   
    <!-- Main -->
    <main layout:fragment="content">
	<!-- 꽃가루 자리 캔버스 -->
	<canvas id="canvas"></canvas>
        <!-- Table -->
        <div class="container">

            <div class="row">
                <!-- Profile Menu -->
        <!-- End Header -->
        <!-- Main -->
        <main>
            <!-- Breadcrumb -->
           <div class="py-3 bg-gray-100">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-6 my-2">
                            <h1 class="m-0 h4 text-center text-lg-start">마이페이지</h1>
                        </div>
                        <div class="col-lg-6 my-2">
                            <ol class="breadcrumb dark-link m-0 small justify-content-center justify-content-lg-end">
                                <li class="breadcrumb-item"><a class="text-nowrap" href="#"><i class="bi bi-home"></i>홈</a></li>
                                <li class="breadcrumb-item text-nowrap active" aria-current="page">마이페이지</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Breadcrumb -->
            <!-- Table -->
            <div class="py-6">
                <div class="container">
                    <div class="row">
                        <!-- Profile Menu -->
                        <div class="col-lg-4 pb-4 pb-lg-0 col-xxl-3  pe-xxl-5">
                            <div class="bg-white border border-bottom-0 shadow-lg">
                                <div class="d-flex p-3 align-items-center">
                                    <div class="avatar avatar-lg rounded-circle">
                                        <img src="../../assets/img/avatar/1000x1000.jpg" title="" alt="">
                                    </div>
                                    <div class="col ps-3">
                                        <h6 class="m-0">닉네임</h6>
                                        <small><a href="#">이름</a></small>
                                    </div>
                                    <div>
                                    	<button>작가변경</button>
                                    </div>
                                </div>
                                <ul class="list-unstyled mb-0 theme-link">
                                    <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" href="account-profile.html">
                                            <i class="fi-user me-2"></i>회원정보수정
                                        </a>
                                    </li>
                                	<li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center active p-3" href="account-order.html">
                                            <i class="bi bi-bag me-2"></i> 주문내역 <div class="ms-auto badge-pill badge bg-secondary"></div>
                                        </a>
                                    </li>
                                	<li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center active p-3" href="account-order.html">
                                            <i class="bi-cash-stack me-2"></i> 내포인트내역 <div class="ms-auto badge-pill badge bg-secondary"></div>
                                        </a>
                                    </li>
                                 	<li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center active p-3" href="account-order.html">
                                            <i class="bi-ticket me-2"></i> 쿠폰내역 <div class="ms-auto badge-pill badge bg-secondary"></div>
                                        </a>
                                    </li>
                                    <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center active p-3" href="account-order.html">
                                            <i class="fi-heart me-2"></i> 찜 <div class="ms-auto badge-pill badge bg-secondary"></div>
                                        </a>
                                    </li>
                                    <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" href="account-wishlist.html">
                                            <i class="bi-hand-thumbs-up me-2"></i>좋아요<div class="ms-auto badge-pill badge bg-secondary"></div>
                                        </a>
                                    </li>
                <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" th:href="@{/silhyun/myPage/myClasses}">
                                            <i class="bi-play-btn me-2"></i>내 클래스 <div class="ms-auto badge-pill badge bg-secondary"></div>
                                        </a>
                                    </li>
                                	<li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" href="account-tickets.html">
                                            <i class="bi-chat-square-dots me-2"></i>문의내역 <div class="ms-auto badge-pill badge bg-secondary"></div>
                                        </a>
                                    </li>
                                    <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" href="account-address.html">
                                            <i class="bi-calendar me-2"></i>캘린더
                                        </a>
                                    </li>
                                    <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" href="account-payment.html">
                                            <i class="bi bi-credit-card me-2"></i>결제내역
                                        </a>
                                    </li>
                                    <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" href="account-payment.html">
                                            <i class="bi-person-bounding-box me-2"></i>내 히스토리
                                        </a>
                                    </li>
                                    <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" href="account-payment.html">
                                            <i class="bi-hand-thumbs-down me-2"></i>신고내역
                                        </a>
                                    </li>
                                    <li class="border-bottom mb-0">
                                        <a class="nav-link-style d-flex align-items-center p-3" href="/mpg/checkPassword">
                                            <i class="bi bi-box-arrow-left me-2"></i>회원탈퇴
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!-- End Profile Menu -->
                <!-- Content -->
				
                <div class="col-lg-8 col-xxl-9">
                                                <section>
                                <div class="container">
                                    <div class="row g-0 px-4 px-lg-5 py-5 rounded bg-cover bg-fiex bg-center border"
                                        style="background-image: url(/img/banner5.jpg);width:854px;">
                                        <div class="col-md-8 my-3 text-center">
                                            <h1 class="h1 m-0" style="color: white; -webkit-text-stroke-width: 1px;
                                            -webkit-text-stroke-color: black;" th:text="${IV.inetNum}+'. '+${IV.inetTtl}"><b></b></h1>
                                        </div>
                                    </div>
                                </div>
                            </section>
                    <br>


                    <!-- video -->

                    <section class="post-details-area mb-80">
                        <div class="container">
                
                                <div class="col-12">
                                  
						         <div id="player"></div>

						                        
               
                            </div>

                        </div>
                                 
                        <div align="center" th:text="${IV.inetDesct}"></div>
             
                    </section>

					</div>
					</div>
					</div>
                </div>
            </div>
        </div>
        <div class="buttonContainer" style="display: none;">
			<button class="canvasBtn" id="stopButton">Stop Confetti</button>
			<button class="canvasBtn" id="startButton">Drop Confetti</button>	
		</div>
	        						<span id="cumlwTime" style="display: none">0</span>
         <input id="classNum" type="hidden" th:value="${IV.classNum}">
        <input id="inetNum" type="hidden" th:value="${IV.inetNum}">
      <input  id="inetVdo" type="hidden" th:value="${IV.inetVdo}">
            <input  id="ewTime" type="hidden" th:value="${IV.ewTime}">
                        <input  id="myId" type="hidden" th:value="${id}">
            
        <!-- 동영상 제어 스크립트  -->
<script src="https://www.youtube.com/iframe_api"></script>
<script type="text/javascript">
	
  var player;
  var interval;
  
  var youtubeUrl = document.getElementById("inetVdo").value;
  var youtubeId = youtubeUrl.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/)[7];
  console.log(youtubeId);
  
  //영상 시간 당기는 초
  
  var myId = document.getElementById("myId").value;
  
  
  var ewTime = document.getElementById("ewTime").value;
  
  
  //아작스로 보낼 값들 
  var inetNum =document.getElementById("inetNum").value;
  
  var classNum = document.getElementById("classNum").value;
  
  
  var stwTime;
  
  var cumlwTime = document.getElementById('cumlwTime');
  
  
  

  
  
  
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '480px',
      width: '854px',
      videoId: youtubeId,
      playerVars: {
    	  start: 0 + ewTime
    	},
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  function onPlayerReady(event) {
    // 재생이 가능한 상태가 되면 호출됨
    console.log("영상 총 길이" + player.getDuration());
  }

  function onPlayerStateChange(event) {
	  
    if (event.data == YT.PlayerState.PLAYING) {
      // 재생이 시작되면 호출됨
      console.log("시작됨");
      
      stwTime = Math.floor(player.getCurrentTime());
      console.log("시작지점. stwTime=" + stwTime);
      //초단위에서 소수점이 있으면 start에서 오류가 남 
      interval = setInterval(count, 1000);
    } else if (event.data == YT.PlayerState.PAUSED) {
      // 재생이 일시정지되면 호출됨
      clearInterval(interval);
      console.log("일시정지됨");
      console.log("cumlwTime="+ cumlwTime.innerText);
     	console.log("stwTime="+stwTime+"/ewTime="+ewTime+"/cumlwTime="+cumlwTime.innerText);
      
     // ewTime = Math.floor(player.getCurrentTime());
      console.log("종료지점 초단위. ewTime = " + ewTime);
      
      
      
    } else if (event.data == YT.PlayerState.ENDED) {
      // 재생이 종료되면 호출됨
      console.log("종료됨");
      clearInterval(interval);
      ewTime = Math.floor(player.getCurrentTime());
      console.log("ewTime="+ewTime+"cumlwTime="+cumlwTime.innerText);
      //console.log("현재 지점 초단위. 여기서는 영상이 종료돼서 종료+종료지점" + Math.floor(player.getCurrentTime()));
      reAction();
    }
  }

	  //꽃가루 이벤트
	  function reAction(){
	  	$("#startButton").trigger("click");
	  	setTimeout(function(){
	  		$("#stopButton").trigger("click");
	  	}, 3000);
	  };
	  
  
  function count() {
	  cumlwTime.innerText = parseInt(cumlwTime.innerText) + 1;

  }
  
  
  setInterval(function() {
	  console.log("진행중. id="+myId)
	   ewTime = Math.floor(player.getCurrentTime());
	  
	  $.ajax({
	    url: "/silhyun/classes/insertWInfo", // 서버 URL
	    type: 'POST', // HTTP 요청 메소드 (POST)
	   // contentType: "application/json",
	    data:{
	    	  inetNum: inetNum,
	    	  classNum: classNum,
	    	  id: myId,
	    	  stwTime: stwTime.toString(),
	    	  ewTime: ewTime.toString(),
	    	  cumlwTime: cumlwTime.textContent
	    	},
	    }).then(vo=>{
	    	console.log(vo);
	    	console.log("inetNum="+inetNum+"classNum="+classNum+
	    			"id="+id+
	    			"stwTime="+stwTime+"ewTime="+ewTime+"cumlwTime="+cumlwTime);
	   
	    	
	  });
	   	cumlwTime.innerText = "0";
	}, 5000); // 5초 간격으로 호출
  
  
</script>

        

        
        
        
    </main>
    <!-- End Content -->


    <!-- script start -->
    <!-- jquery -->
    <script src="/js/jquery-3.5.1.min.js"></script>
    <!--bootstrap-->
    <script src="/js/bootstrap.bundle.min.js"></script>
    <!-- slick carousel -->
    <script src="/vendor/swiper/swiper-bundle.min.js"></script>
    <!-- magnific -->
    <script src="/vendor/magnific/jquery.magnific-popup.min.js"></script>
    <!-- isotope -->
    <script src="/vendor/isotope/isotope.pkgd.min.js"></script>
    <!-- count-down -->
    <script src="/vendor/count-down/jquery.countdown.min.js"></script>
    <!-- Theme Js -->
    <script src="/js/custom.js"></script>
    <script src="/js/theme.js"></script>
    <!-- End script start -->
</body>

</html>